// COPYRIGHT 2008 - CitrusMediaGroup - All Rights Reserved
Mootils.NetStatus=new Class({Implements:Options,options:{parent:null,alignWith:'mouse',margin:21,coords:null,src:'/images/netstatus.png',size:27,timeout:15},initialize:function(options){if(typeof(Mootils.NetStatus.$prototype)!=='undefined')this.setOptions(Mootils.NetStatus.$prototype);this.setOptions(options);this.div=this.create();window.addEvent('resize',this.handleResize.bind(this));},create:function(){return new Element('div',{'id':'netStatus'+Math.random(),'class':'png','styles':{'position':'absolute','display':'block','width':this.options.size+'px','height':this.options.size+'px','background':'transparent url('+this.options.src+') 0 0 no-repeat','z-index':8500,'opacity':0}});},start:function(){if(this.status==='loading')return false;if(!this.aligned)this.alignWith();this.pos=0;this.loops=0;this.status='loading';this.div.fade('show');this.animInt=$clear(this.animInt);this.animInt=this.anim.periodical(100,this);return this;},stop:function(navTo){this.statusInt=$clear(this.statusInt);this.statusInt=this.setStatus.delay(350,this,'idle');if(navTo)this.setLocation.delay(500,this,navTo);return this.remove();},error:function(s){if(!this.aligned)this.alignWith();this.status=s?s:'error';this.div.setStyle('backgroundPosition','0 '+-(this.options.size*12)+'px').fade('show');return this;},hide:function(navTo){this.div.fade('out');this.stop.delay(1000,this);if(navTo)this.setLocation.delay(500,this,navTo);return null;},remove:function(){this.status='idle';window.removeEvent('mousemove',this.mouseMove);this.div=this.div.dispose();return null;},anim:function(){if(this.status!='loading')this.animInt=$clear(this.animInt);else{this.pos-=this.options.size;if(this.pos<=-(this.options.size*12)){this.pos=0;this.loops++;if(this.loops>=this.options.timeout){this.status='idle';this.error('timeout');return false;}}
this.div.setStyle('backgroundPosition','0 '+this.pos+'px');}},alignWith:function(){if($chk(arguments[0])){this.options.alignWith=null;this.options.coords=null;switch($type(arguments[0])){case'string':this.options.alignWith=arguments[0];break;case'number':this.options.coords={x:arguments[0],y:arguments[1]?arguments[1]:arguments[0]};break;case'object':var obj=arguments[0];this.options.alignWith=obj.alignWith;this.options.coords=obj.coords?obj.coords:null;break;}}
if(this.options.alignWith==='mouse'){this.mouseMove=this.handleMouseMove.bind(this);window.addEvent('mousemove',this.mouseMove);}else{if(this.mouseMove){window.removeEvent('mousemove',this.mouseMove);this.mouseMove=null;}
this.options.alignWith=$(this.options.alignWith);this.options.parent=this.options.parent?$(this.options.parent):(this.options.alignWith?this.options.alignWith.getParent():document.body);if(this.options.coords)this.div.setStyles({left:this.options.coords.x,top:this.options.coords.y});else if(this.options.alignWith){var cords=this.options.alignWith.getCoordinates(this.options.parent);this.div.setStyles({left:(cords.left+cords.width+this.options.margin)+'px',top:(cords.top+(cords.height*0.5)-(this.options.size*0.5))+'px'});}
this.options.parent.adopt(this.div);}
this.aligned=true;return this;},setLocation:function(navTo){window.location.href=navTo;},setStatus:function(status){this.statusInt=$clear(this.statusInt);this.status=status;return this;},handleResize:function(evt){if(this.options.alignWith!=null)this.alignWith(this.options.alignWith);},handleMouseMove:function(evt){this.winScroll=window.getScroll();this.div.setStyles({left:this.winScroll.x+(evt.client.x+(this.options.size*0.5))+'px',top:this.winScroll.y+(evt.client.y-this.options.size)+'px'});if(!this.div.getParent())this.div.inject(document.body);},getPosition:function(){return this.div.getPosition();}});Mootils.NetStatus.getOptions=function(){if(typeof(Mootils.NetStatus.$prototype)!=='undefined')return Mootils.NetStatus.$prototype;else return Mootils.NetStatus.prototype.options;}
window.addEvent('domready',function(evt){var src=Mootils.NetStatus.getOptions().src;if(src)Mootils.preload(src);});